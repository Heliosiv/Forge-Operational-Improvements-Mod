<div class="po-window po-window-rest-player" data-tool="rest-watch-player" role="region" aria-label="Party Operations Rest Watch Player View">
  <header class="po-header">
    <div class="po-header-main">
      <h1 class="po-title">Party Operations</h1>
      <div class="po-subtitle" aria-live="polite">Rest Watch (Player) - Last updated {{lastUpdatedAt}} by {{lastUpdatedBy}}</div>
    </div>
    <div class="po-context-pill" aria-hidden="true">Player View</div>
    <div class="po-controls">
      <button type="button" class="po-icon-btn" data-action="refresh" aria-label="Refresh">
        <i class="fa-solid fa-rotate"></i>
      </button>
    </div>
  </header>

  {{#if lockBannerText}}
  <div class="po-lock-banner {{lockBannerClass}}" title="{{lockBannerTooltip}}">{{lockBannerText}}</div>
  {{/if}}

  <div class="po-body">
  <section class="po-overview" aria-label="Rest watch status">
    <article class="po-overview-card">
      <span>Slots Filled</span>
      <strong>{{overview.occupiedSlots}} / {{overview.totalSlots}}</strong>
    </article>
    <article class="po-overview-card">
      <span>Assigned Entries</span>
      <strong>{{overview.assignedEntries}}</strong>
    </article>
    <article class="po-overview-card {{#if overview.hasLowDarkvisionCoverage}}is-alert{{/if}}">
      <span>Low Darkvision Slots</span>
      <strong>{{overview.lowDarkvisionSlots}}</strong>
    </article>
    <article class="po-overview-card">
      <span>Lock Status</span>
      <strong>{{overview.lockState}}</strong>
    </article>
  </section>

  <section class="po-content">
    <div class="po-hint">Tip: use <strong>Assign Me</strong> to quickly claim an empty watch slot, then add notes only for your actor.</div>
    <div class="po-cards">
      {{#each slots}}
      <article class="po-card" data-slot-id="{{id}}">
        <div class="po-card-left">
          <div class="po-slot-badge">{{label}}</div>
          {{#if timeRange}}
          <div class="po-time-range">{{timeRange}}</div>
          {{/if}}
        </div>

        <div class="po-card-center">
          {{#if hasEntries}}
          {{#each entries}}
          <div class="po-watch-entry" data-actor-id="{{actorId}}">
            <div class="po-actor">
              <img class="po-portrait" src="{{actor.img}}" alt="{{actor.name}}" />
              <div class="po-actor-meta">
                <div class="po-actor-name">
                  {{actor.name}}
                  <button type="button" class="po-icon-btn" data-action="ping" aria-label="Ping token">
                    <i class="fa-solid fa-location-dot"></i>
                  </button>
                </div>
                <div class="po-watch-stats">
                  {{#if actor.passivePerception}}
                  <div class="po-stat po-stat-primary">
                    <span class="po-stat-label">PP</span>
                    <span class="po-stat-value">{{actor.passivePerception}}</span>
                  </div>
                  {{/if}}
                </div>
              </div>
            </div>

            {{#if activity}}
            <div class="po-activity-section">
              <div class="po-activity-row is-compact">
                <div class="po-exhaustion-badge {{#if activity.exhaustion}}is-exhausted{{/if}}" title="Exhaustion: {{activity.exhaustionLabel}}">
                  {{#if activity.exhaustion}}
                  <i class="fa-solid fa-heart-crack"></i>
                  <span>{{activity.exhaustion}}</span>
                  {{else}}
                  <i class="fa-solid fa-heart"></i>
                  {{/if}}
                </div>

                <label class="po-sr-only" for="po-player-activity-{{../id}}-{{actorId}}">Activity for {{actor.name}}</label>
                <select id="po-player-activity-{{../id}}-{{actorId}}" class="po-activity-select" data-action="set-activity" data-actor-id="{{actorId}}" aria-label="Activity for {{actor.name}}">
                  {{#each activity.activityOptions}}
                  <option value="{{value}}" {{#if selected}}selected{{/if}}>{{label}}</option>
                  {{/each}}
                </select>
              </div>
            </div>
            {{/if}}

            <div class="po-entry-actions">
              <button type="button" class="po-icon-btn" data-action="toggle-notes" aria-controls="po-player-notes-{{../id}}-{{actorId}}" aria-expanded="{{#if notes}}true{{else}}false{{/if}}" aria-label="Toggle notes for {{actor.name}}">
                <i class="fa-solid fa-note-sticky"></i>
              </button>
              {{#if canClear}}
              <button type="button" class="po-icon-btn" data-action="clear" aria-label="Clear">
                <i class="fa-solid fa-xmark"></i>
              </button>
              {{/if}}
            </div>

            <div id="po-player-notes-{{../id}}-{{actorId}}" class="po-notes {{#if notes}}is-active{{/if}}" aria-hidden="{{#if notes}}false{{else}}true{{/if}}">
              <label class="po-sr-only" for="po-player-note-input-{{../id}}-{{actorId}}">Notes for {{actor.name}}</label>
              <textarea id="po-player-note-input-{{../id}}-{{actorId}}" class="po-notes-input" rows="2" placeholder="Notes" aria-label="Notes for {{actor.name}}" {{#unless canEditNotes}}disabled{{/unless}}>{{notes}}</textarea>
            </div>
          </div>
          {{/each}}
          {{/if}}

          {{#unless hasEntries}}
          <div class="po-empty">
            <div class="po-empty-text">Assign character(s)...</div>
          </div>
          {{/unless}}

          <div class="po-assign-actions">
            {{#if canAssignMe}}
            <button type="button" class="po-btn is-primary" data-action="assign-me">+ Assign Me</button>
            {{/if}}
          </div>
        </div>
      </article>
      {{/each}}
    </div>
  </section>
  </div>

  <footer class="po-footer">
    <div class="po-footer-text">Rest Watch</div>
    <div class="po-footer-text">Player view</div>
  </footer>
</div>


